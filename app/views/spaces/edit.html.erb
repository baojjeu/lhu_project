<!-- <ol class="breadcrumb">
  <li class="active"><a href="#">場地規劃</a></li>
  <li>場地資訊、租借時間設定</li>
  <li>瀏覽</li>
</ol> -->

<%= render 'layouts/breadcrumb' %>

<div class="container space-edit-container" style="width: 97%">

  <section class="line"></section>

  <!-- space id -->


  <div class="main_function">
    <div class="sidebar">



      <% @blocks.each do |block| %>
        <ul class="closed">

          <!-- grandpa block name -->
          <span class="sidebar_grandpa_name" id="block_ul-<%= block.id %>" data-spaceid="<%= block.space_id %>" data-blocktype="<%= block.block_type %>"><%= block.name %></span> <% if Block.where(parent_id: block.id).count > 0 %> (<span class="block_qty"><%= Block.where(parent_id: block.id).count %></span>) <% end %>

          <!-- father blocks -->
          <% Block.where(parent_id: block.id).order('name DESC').each do |father| %>
            <ul class="father_holder closed">

              <!-- father name -->
              <span class="sidebar_father_name" id="block_fa-<%= father.id %>" data-isfloor="<%= father.is_floor %>" data-blocktype="<%= father.block_type %>"><%= father.name %></span> <% if Block.where(parent_id: father.id).count > 0 %> (<span class="block_qty"><%= Block.where(parent_id: father.id).count %></span>) <% end %>


              <!-- child blocks -->
              <% Block.where(parent_id: father.id).each do |child| %>
                <li class="sidebar_child_name" id="block_ch-<%= child.id %>" data-blocktype="<%= child.block_type %>"><%= child.name %></li>
              <% end %>
            </ul>
          <% end %>
        </ul>
      <% end %>
    </div> <!-- sidebar -->

    <!-- blocks -->
    <div class="editor" data-spaceid="<%= @space.id %>" style="height: <%= @space.height %>;">

      <% @blocks.each do |block| %>
        <div id="block-<%= block.id %>" class="newdiv" data-blocktype="<%= block.block_type %>" data-spaceid="<%= block.space_id %>" style="width: <%= block.width %>px; height: <%= block.height %>px; top: <%= block.top %>px; left: <%= block.left %>px; background-color: <%= block.color %>"><span class="namename"><%= best_in_place block, :name %></span><%= link_to '×', block, class: 'block_close', method: :delete %> <i class="fa fa-cog block_edit"></i> <% if Block.where(parent_id: block.id).count > 0 %> (<span class="block_qty"><%= Block.where(parent_id: block.id).count %></span>) <% end %>

          <div style="width: 22px; height: 24px; border: 1px solid #7f7f7f; position: absolute; bottom: 1%; left: 1%;">
            <select name="colorpicker" data-block="<%= block.id %>">
              <option value="<%= block.color %>"></option>
              <option value="#7bd148">Green</option>
              <option value="#5484ed">Bold blue</option>
              <option value="#a4bdfc">Blue</option>
              <option value="#46d6db">Turquoise</option>
              <option value="#7ae7bf">Light green</option>
              <option value="#fbd75b">Yellow</option>
              <option value="#ffb878">Orange</option>
              <option value="#ff887c">Red</option>
              <option value="#dbadff">Purple</option>
              <option value="#efefef">Gray</option>
            </select>
          </div>

        </div>
      <% end %>
    </div> <!-- editor -->
  </div> <!-- main_function -->


  <nav class="navbar navbar-default navbar-fixed-bottom" style="border: none" role="navigation">
    <div class="row" style="margin-left: 2%; position:">
      <div class="col-md-3 col-md-offset-1">
        <%= link_to '主平面圖', edit_space_path(@space), id: 'reload_and_main_pic', class: 'btn btn-success', style: 'float: left; margin-left: 15%;' %>
      </div>
      <div class="col-md-3 col-md-offset-1">
        <button class="enlarge btn btn-default">↓</button>
        <button class="orig btn btn-default">維持原狀</button>
        <button class="ensmall btn btn-default">↑</button>
      </div>
      <div class="col-md-3" style="float: right">
        <%= link_to '上一步', spaceinfo_space_path, class: 'btn btn-default' %>
        <%= link_to '下一步', detailize_space_path(@space), class: 'btn btn-primary' %>
      </div>
    </div>
  </nav>

</div> <!-- container -->




<% if @space.surface? %>
  <%= javascript_include_tag 'space-edit-surface.js' %>
<% else %>
  <%= javascript_include_tag 'space-edit-no-surface.js' %>
<% end %>

<script>

  $('.enlarge').click(function() {
    // alert(height);
    $('.editor').css({
      'height': $('.editor').height() + 100
    });

    $.ajax({
      type: 'PUT',
      url: '/spaces/' + "<%= @space.id %>",
      data: JSON.stringify( { 'height': $('.editor').height() + 'px' } ),
      dataType: 'json',
      contentType: 'application/json'
    });
  });

  $('.ensmall').click(function() {
    // alert(height);

    if($('.editor').height() > $('.sidebar').height()) {
      $('.editor').css({
        'height': $('.editor').height() - 100
      });

      $.ajax({
        type: 'PUT',
        url: '/spaces/' + "<%= @space.id %>",
        data: JSON.stringify( { 'height': $('.editor').height() + 'px' } ),
        dataType: 'json',
        contentType: 'application/json'
      });
    }

  });

  $('.orig').click(function() {
    // alert(height);


    $('.editor').css({
      'height': '72vh'
    });

    $.ajax({
      type: 'PUT',
      url: '/spaces/' + "<%= @space.id %>",
      data: JSON.stringify( { 'height': '72vh' } ),
      dataType: 'json',
      contentType: 'application/json'
    });


  });

  $('select[name="colorpicker"]').simplecolorpicker({
    picker: true
  }).on('change', function() {
    var thisblock = $(this).data('block');
    var color = $(this).val();
    $('#block-' + thisblock).css('background-color', color);
    $.ajax({
      type: 'PUT',
      url: '/blocks/' + thisblock,
      data: JSON.stringify( { 'color': color } ),
      dataType: 'json',
      contentType: 'application/json'
    });
  });


</script>